name: CI
on:
  pull_request:
    paths:
      - Sources/**
      - Tests/**
      - .github/workflows/ci.yml
jobs:
  auto-cancel:
    runs-on: ubuntu-latest
    steps:
    - uses: technote-space/auto-cancel-redundant-job@v1
  macOS:
    needs: auto-cancel
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - run: swift package generate-xcodeproj --enable-code-coverage
    - uses: sersoft-gmbh/xcodebuild-action@v1
      with:
        project: Version.xcodeproj
        scheme: Version-Package
        action: test
    - uses: codecov/codecov-action@v1
  linux:
    needs: auto-cancel
    runs-on: ubuntu-18.04
    strategy:
      matrix:
        swift:
        - '4.2'
        - '5.0'
        - '5.1'
        - '5.2'
        - '5.3'
        - '5.4'
    container:
      image: swift:${{ matrix.swift }}
    steps:
    - uses: actions/checkout@v2
    - run: swift build
